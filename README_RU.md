# Dahua2MQTT

## Обзор
Dahua2MQTT — это дополнение к Home Assistant, предназначенное для интеграции систем видеонаблюдения Dahua с Home Assistant через MQTT. Оно позволяет в реальном времени отслеживать события, такие как распознавание лиц и умное обнаружение движений (SMD), непосредственно в Home Assistant. **Это дополнение прослушивает HTTP-оповещения от устройств Dahua (NVR, камеры и т.д.) и публикует соответствующие события в MQTT-брокер Home Assistant**, что позволяет создавать бинарные датчики или триггеры автоматизации на основе этих событий.

## Функции
- **Распознавание лиц**: Определяет, когда устройство Dahua распознает известное или неизвестное лицо.
- **Умное обнаружение движений**: Определяет, когда обнаружено движение, различая движение человека и транспортного средства.
- **Оповещения в реальном времени**: Отправляет оповещения в реальном времени в Home Assistant, позволяя немедленно реагировать или запускать автоматизацию.
- **Настраиваемые темы**: Позволяет настраивать MQTT-темы для различных типов событий, обеспечивая гибкость в проектировании автоматизации.

## Требования
Для использования Dahua2MQTT вам потребуется:
- Устройство видеонаблюдения Dahua (например, DHI-NVR5216-EI) с версией прошивки DH_NVR5XXX-EI_MultiLang_V4.003.0000000.0.R.231229 или совместимой.
- Home Assistant с настроенным и сконфигурированным MQTT-брокером.
- Базовые знания о создании и настройке бинарных датчиков в Home Assistant.

## Начало работы
1. **Установите дополнение**: Следуйте стандартной процедуре для установки этого дополнения в Home Assistant.
2. **Настройте MQTT**: Убедитесь, что ваш MQTT-брокер правильно настроен в Home Assistant, и запишите учетные данные.
3. **Конфигурация дополнения**: Введите данные вашего MQTT-брокера и предпочтительные темы в конфигурацию дополнения.
4. **Создайте бинарные датчики**: В Home Assistant создайте бинарные датчики, соответствующие MQTT-темам, которые вы настроили в дополнении. Это позволит вам реагировать на события от вашего устройства Dahua в Home Assistant.

## Конфигурация
Вот пример необходимой конфигурации в `configuration.yaml` для бинарных датчиков:

```yaml
mqtt:
  binary_sensor:
    - name: "NVR - Распознано лицо"
      state_topic: "dahua2mqtt/face/recognized/state"
      value_template: "{{ value_json.state }}"
      off_delay: 5  # Выключает датчик через 5 секунд
      device_class: motion
      json_attributes_topic: "dahua2mqtt/face/recognized/state"
      json_attributes_template: "{{ value_json.attributes | tojson }}"
  
    - name: "NVR - Обнаружен человек"
      state_topic: "dahua2mqtt/smd/human/state"
      value_template: "{{ value_json.state }}"
      off_delay: 5  # Выключает датчик через 5 секунд
      device_class: motion
```

## Участие в проекте
Dahua2MQTT — это проект с открытым исходным кодом, и мы приветствуем любую помощь! Будь то исправление ошибок, добавление новых функций или улучшение документации — ваш вклад ценится. Не стесняйтесь форкать репозиторий, вносить свои изменения и отправлять запрос на слияние.

## TO-DO:
- Реализовать функцию MQTT Discovery Home Assistant.
- Реализовать функцию Supervisor_token.
- Переработать код, чтобы он был готов к изменениям HTTP API от Dahua.
